<include file="Public/min-header" />
<div class="wrapper">
    <include file="Public/breadcrumb"/>
	<section class="content">
       <div class="row">
       		<div class="col-xs-12">
	       		<div class="box">
	             <div class="box-header">
	               	<nav class="navbar navbar-default">	     
				        <div class="collapse navbar-collapse">
				          <form class="navbar-form form-inline" action="{:U('System/banner')}" method="get">
				            <div class="form-group pull-right">
					            <a href="javascript:void(0)" onclick="edit_banner()" class="btn btn-primary pull-right"><i class="fa fa-plus"></i>添加Banner</a>
				            </div>
				          </form>
				      	</div>
	    			</nav>
	             </div>
	             <div class="box-body">
	           		<div class="row">
	            	<div class="col-sm-12">
		              <table id="list-table" class="table table-bordered table-striped dataTable">
		                 <thead>
		                   <tr role="row">
			                   <th width="10%">ID</th>
			                   <th width="15%">排序</th>
			                   <th width="25%">链接</th>
			                   <th width="20%">图片</th>
			                   <th width="15%">添加时间</th>
			                   <th width="15%">操作</th>
		                   </tr>
		                 </thead>
						<tbody>
						  <foreach name="list" item="vo" key="k" >
						  	<tr role="row" align="center">
		                     <td>{$vo.id}</td>
        		             <td>
		                     	<input name="info[sort_index]" type="text" value="{$vo.sort_index}" onblur="change_sort('{$vo.id}',this.value)"/>
		                     </td>
		                     <td>
		                     	<a href="{$vo.link}" target="_blank">{:mb_strlen($vo['link'])>30?substr($vo['link'],0,30).'...':$vo['link']}</a>
		                     </td>
		                     <td><img src="{$vo.pic}" onclick="window.open('{$vo.pic}')" style="cursor:pointer; height:50px;"></td>
                             <td>{$vo.create_date}</td>
		                     <td>
			                     <a title="编辑" class="btn btn-primary" href="javascript:void(0)" onclick="edit_banner('{$vo.id}')"><i class="fa fa-pencil"></i></a>
			                     <a title="删除" class="btn btn-danger" href="javascript:void(0)" data-id="{$vo.id}" onclick="dele_banner('{$vo.id}')"><i class="fa fa-trash-o"></i></a>
							 </td>
		                   </tr>
		                  </foreach>
		                   </tbody>
		                 <tfoot>                 
		                 </tfoot>
		               </table>
	               </div>
	          </div>
              <div class="row">
              	    <div class="col-sm-6 text-left"></div>
                    <div class="col-sm-6 text-right">{$page}</div>		
              </div>
	         </div>
	        </div>
       	</div>
       </div>
   </section>
</div>
<script src="__PUBLIC__/js/ajaxfileupload.js" type="text/javascript"></script>
<include file="Public/dialog"/>
<script>
function change_sort(id,sort_index){
	$.post("{:U('System/edit_banner')}",{info:{id:id,sort_index:$.trim(sort_index)},act:'save'},function(res){
		if(res.status == '1') location.reload();
	});
}
function edit_banner(id){
	$.post("{:U('System/edit_banner')}",{act:'show',id:id},function(data){
		dialog(data,'添加Banner',function(){
			$.post("{:U('System/edit_banner')}",$('#dataForm').serializeArray(),function(res){
				if(res.status == '1'){
					jsalert(res.info,1,function(){
						location.reload();
					});
				}else{
					jsalert(res.info,2);
				}
			});
		})
	});
}

function dele_banner(id){
	jsconfirm('确认要删除吗？',function(){
		$.ajax({
			type : 'post',
			url : '{:U("System/dele_banner")}',
			data : {id:id},
			dataType : 'json',
			success : function(data){
				if(data.status == '1'){
					jsalert(data.info,1,function(){
						location.reload();
					});
				}else{
					alert(data.info)
					jsalert(data.info,2);
				}
			}
		})
	});
	return false;
}

function upload_img(ele_id,save_id){
	upload(ele_id,function(data){
		if(data.status == '1'){
	 		$('#'+ele_id).prev('img').attr('src',data.info.image_url);
	 		$('#'+save_id).val(data.info.image_url);
	 	}else{
	 		jsalert(data.info,2);
	 	}
	});
}

</script> 
</body>
</html>