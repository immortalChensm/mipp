<include file="Public/min-header" />
<include file="Public/datepicker" />
<script>
window.onload = function(){
    iniDate('start_date');
    iniDate('end_date');
}
function export_order(){
    var keyword = $.trim($('input[name=keyword]').val());
    var phone = $.trim($('input[name=phone]').val());
    var sex = $.trim($('input[name=sex]').val());
    location.href="{:U('Export/enroll')}?keyword="+keyword+"&phone="+phone+"&sex="+sex;
}
</script>
<div class="wrapper">
    <include file="Public/breadcrumb"/>
	<section class="content">
       <div class="row">
       		<div class="col-xs-12">
	       		<div class="box">
	             <div class="box-header">
	               	<nav class="navbar navbar-default">	     
				        <div class="collapse navbar-collapse">
				          <form class="navbar-form form-inline" action="{:U('Order/user_order')}" method="get">
				          <input type="hidden" name="user_id" value="{$user_info.id}"/>
				          <div class="form-group" style="font-weight:bold;font-size: 16px;margin-right:6px;">{:$user_info['name']?$user_info['name']:$user_info['nickname']}的订单</div>
				            <div class="form-group">
				              	<input type="text" name="keywords" class="form-control" placeholder="订单号" value="{$request_data.keywords}">
				              	<select name="type" class="form-control">
				              	<option value="">订单类型</option>
				              	<option value="1" {:$request_data['type'] == 1 ? 'selected':''} >普通订单</option>
				              	<option value="2" {:$request_data['type'] == 2 ? 'selected':''} >预约订单</option>
				              	</select>
				            </div>
				            <button type="submit" class="btn btn-default">搜索</button>
				            <div class="form-group pull-right">
					            <a href="javascript:void(0)" onclick="history.back('-1')" class="btn btn-default pull-right"><i class="fa fa-reply"></i></a>
				            </div>
				          </form>		
				      	</div>
	    			</nav>
	             </div>	             
	             <div class="box-body">	               
	           		<div class="row">
	            	<div class="col-sm-12">
		              <table id="list-table" class="table table-bordered table-striped dataTable">
		                 <thead>
		                   <tr role="row">
			                   <th>ID</th>
			                   <th>订单号</th>
			                   <th>订单类型</th>
			                   <th>课程名称</th>
			                   <th>授课老师</th>
							   <th>价格</th>
							   <th>状态</th>
			                   <th>下单时间</th>
			                   <th>操作</th>
		                   </tr>
		                 </thead>
						<tbody>
						  <foreach name="list" item="vo" key="k" >
						  	<tr role="row" align="center">
		                     <td>{$vo.id}</td>
		                     <td>{$vo.order_sn}</td>
		                     <td>{:$vo['type'] == '1'?'普通订单':'预约订单'}</td>
		                     <td>{$vo.course.name|default='--'}</td>
							 <td>{$vo.teacher.name|default='--'}</td>
		                     <td>{$vo.price}</td>
		                     <if condition="$vo.type eq 1">
			                     <if condition="$vo.status eq  1"> 
                                 <td style="color:red;">待支付</td>
                                 <elseif condition="$vo.status eq  2"/>
                                 <td style="color:#f39c12;">待评价</td>
                                 <elseif condition="$vo.status eq  3"/>
                                 <td style="color:#25be13;">已完成</td>
                                 </if>
		                     <else/>
            			         <if condition="$vo.status eq  2"> 
			                     <td style="color:#f39c12;">预约中</td>
			                     <elseif condition="$vo.status eq  3"/>
			                     <td style="color:#25be13;">已完成</td>
			                     </if>
		                     </if>
		                     <td>{$vo.create_date}</td>
		                     <td>
		                       <a title="订单详情" class="btn btn-primary" href="javascript:void(0)" onclick="view_detail('{$vo.id}')"><i class="fa fa-eye"></i></a>
		                       <if condition="$vo.status lt 3">
		                       <a title="关闭订单" class="btn btn-danger" href="javascript:void(0)" onclick="close_order('{$vo.id}')"><i class="fa fa-power-off"></i></a>
							   </if>
							 </td>
		                   </tr>
		                  </foreach>
		                   </tbody>
		                 <tfoot>		                 
		                 </tfoot>
		               </table>	 
		               <if condition="$list eq null">
                           <include file="Public/none" />
                       </if>
	               </div>
	          </div>
              <div class="row">
              	    <div class="col-sm-6 text-left"></div>
                    <div class="col-sm-6 text-right">{$page}</div>
              </div>
	         </div>
	        </div>
       	</div>
       </div>
   </section>
</div>
<include file="Public/dialog" />
<script>
function view_detail(id){
	$.post("{:U('Order/detail')}",{id:id},function(res){
		dialog(res,'订单详情');
	});
}
function close_order(id){
	jsconfirm('确定要关闭此订单吗？',function(){
		$.post("{:U('Order/close_order')}",{id:id},function(res){
			if(res.status == '1') {
				location.reload();
				return false;
			}else{
				jsalert(res.info,2);
			}
		});
	});
}
</script>
</body>
</html>