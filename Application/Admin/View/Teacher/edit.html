<include file="Public/min-header"/>
<script src="__PUBLIC__/js/ajaxfileupload.js" type="text/javascript"></script>
<style>
.col-sm-8 .image-contain{width:60%;}
.col-sm-8 .image-contain .image-div{width:120px;height:120px;border:1px solid #ccc;float:left;margin-right: 4px;margin-bottom: 4px;position:relative;}
.col-sm-8 .image-contain .image-div .delete-img{width:100%;height:30px;bottom:0;cursor:pointer;background:#000;opacity:0.6;line-height:30px;text-align:center;opacity: 0.5;position: absolute;color:#fff;display:none;}
.col-sm-8 .image-contain #image_btn{background:url(__PUBLIC__/Admin/images/default.png) no-repeat center;background-size:cover;cursor:pointer;}
.col-sm-8 .upvideo{margin-top:8px;}
.col-sm-8 .upvideo input{cursor:pointer;}
</style>
<include file="Public/myeditor"/>
<script>
myeditor('content');
</script>
<div class="wrapper">
    <include file="Public/breadcrumb"/>
    <section class="content" style="padding:0px 15px;">
        <!-- Main content -->
        <div class="container-fluid">
            <div class="pull-right">
                <a href="javascript:history.go(-1)" data-toggle="tooltip" title="" class="btn btn-default" data-original-title="返回"><i class="fa fa-reply"></i></a>
            </div>
            <div class="panel panel-default">     
            	<div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-list"></i> 编辑教师信息</h3>
                </div>      
                <div class="panel-body ">   
                    <!--表单数据-->
                    <form method="post" id="dataForm">    
                    <input type="hidden" name="info[id]" value="{$info.id}"/>       
                        <!--通用信息-->
                    <div class="tab-content" style="padding:20px 0px;">                 	  
                        <div class="tab-pane active" id="tab_tongyong">
                            <table class="table table-bordered">
                                <tbody>
                                <tr>
                                    <td class="col-sm-2">姓名：</td>
                                    <td class="col-sm-8">
                                        <input type="text" class="form-control" name="info[name]" value="{$info.name}" placeholder="请输入老师姓名"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">性别：</td>
                                    <td class="col-sm-8">
                                        <label><input type="radio" name="info[sex]" value="1" {:$info['sex'] == '1'?'checked':''}> 男</label>
                                        <label><input type="radio" name="info[sex]" value="2" {:$info['sex'] == '2'?'checked':''}> 女</label>
                                    </td>
                                </tr>                            
                                <tr>
                                    <td class="col-sm-2">手机号：</td>
                                    <td class="col-sm-8">
                                        <input type="text" class="form-control" name="info[phone]" value="{$info.phone}" placeholder="请输入手机号"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">邮箱：</td>
                                    <td class="col-sm-8">
                                        <input type="text" class="form-control" name="info[email]" value="{$info.email}" placeholder="请输入邮箱账号"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">经纬度：</td>
                                    <td class="col-sm-8">
                                        <input type="text" class="form-control" name="location" value="{:$info['lng'].','.$info['lat']}" placeholder="请输入经纬度"/>
                                        <span style="color:#F00; "> <a href="http://api.map.baidu.com/lbsapi/getpoint/index.html" target="_blank">点此获取经纬度</a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">授课类型：</td>
                                    <td class="col-sm-8">
                                        <select class="form-control" name="info[teach_type]">
                                            <option value="">请选择授课类型</option>
                                            <foreach name="teach_types" key="key" item="val">
                                                <option value="{$key}" {:$info['teach_type'] == $key ? 'selected' :''}>{$val}</option>
                                            </foreach>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">老师头像：</td>
                                    <td class="col-sm-8">
										<div  class="image-contain" >
											<if condition="$info.headimgurl neq null">
											<div class="image-div" style="background:url({$info.headimgurl}) no-repeat center;background-size:cover;" id="image_btn" onclick="$(this).next('input[name=upimg]').click()"></div>
											<else/>
											<div class="image-div" style="background:url(__PUBLIC__/Admin/images/default.png) no-repeat center;background-size:cover;" id="image_btn" onclick="$(this).next('input[name=upimg]').click()"></div>
											</if>
											<input type="file" id="upimg" name="upimg" onchange="upload_img(this.id)" style="display:none;"/>
											<input type="hidden" name="info[headimgurl]" value="{$info.headimgurl}"/>
										</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">介绍视频：</td>
                                    <td class="col-sm-8">
                                    	<if condition="$info.links neq null">
                                    	<foreach name="info.links" item="val" key="key">
                                    	<if condition="$key eq 0">
                                    	<div class="upvideo">
	                                        <input type="text" class="form-control" onclick="$(this).next().click()" readonly name="info[links][]" value="{$val}" placeholder="点击上传视频，视频大小最大为10M">
                                            <input type="file" id="link{$key}" name="link{$key}" style="display:none;" onchange="upload_video(this.id)"/>
	                                        <span class="btn btn-primary" title="添加" ><i class="fa fa-plus"></i></span>
                                        </div>
                                        <else/>
                                    	<div class="upvideo">
	                                        <input type="text" class="form-control" onclick="$(this).next().click()" readonly name="info[links][]" value="{$val}" placeholder="点击上传视频，视频大小最大为10M">
                                            <input type="file" id="link{$key}" name="link{$key}" style="display:none;" onchange="upload_video(this.id)"/>
	                                        <span class="btn btn-danger" title="删除" ><i class="fa fa-trash-o"></i></span>
                                        </div>
                                        </if>
                                        </foreach>
                                        <else/>
                                        <div class="upvideo">
	                                        <input type="text" class="form-control" onclick="$(this).next().click()" readonly name="info[links][]" placeholder="点击上传视频，视频大小最大为10M">
                                            <input type="file" id="link0" name="link0" style="display:none;" onchange="upload_video(this.id)"/>
	                                        <span class="btn btn-primary" title="删除" ><i class="fa fa-plus"></i></span>
                                        </div>
                                        </if>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-sm-2">教师简介：</td>
                                    <td class="col-sm-8">
                                        <textarea style="resize:none;height:80px;"  class="form-control" name="info[profile]">{$info.profile}</textarea>
                                    </td>                                                                       
                                </tr>
                                <tr>
                                    <td class="col-sm-2">教师详情：</td>
                                    <td width="85%" class="col-sm-8">
                                        <textarea class="span12 ckeditor" id="content" name="info[content]" title="">{$info.content}</textarea>
                                    </td>                                                                       
                                </tr>  
                                </tbody> 
                                <tfoot>
                                	<tr>
                                	<td><!-- <input type="hidden" name="inc_type" value="{$inc_type}"> --></td>
                                	<td class="text-right"><input class="btn btn-primary" type="button" onclick="save()" value="保存"></td></tr>
                                </tfoot>                               
                                </table>
                        </div>                           
                    </div>              
			    	</form><!--表单数据-->
                </div>
            </div>
        </div>
    </section>
</div>
<script type="text/plain" id="myEditor"></script>
<script type="text/plain" id="upload_ue"></script>
<script>
     //重新实例化一个编辑器，防止在上面的editor编辑器中显示上传的图片或者文件
     var _editor = UE.getEditor('upload_ue');
     _editor.ready(function () {
         _editor.addListener('afterUpVideo',function(t, arg) {  
                    console.log(arg);  
            }); 
         //设置编辑器不可用
         _editor.setDisabled();
         //隐藏编辑器，因为不会用到这个编辑器实例，所以要隐藏
         _editor.hide();
         //侦听视频上传结束
        
     });
     //弹出图片上传的对话框
     function upImage() {
         var myImage = _editor.getDialog("insertimage");
         myImage.open();
     }
     //弹出文件上传的对话框
     function upFiles() {
         var myFiles = _editor.getDialog("attachment");
         myFiles.open();
     }
   	 //弹出视频上传的对话框
     function upVideos() {
         var myFiles = _editor.getDialog("insertvideo");
         myFiles.open();
     }
</script> 
<script>
$(function(){
    var vdo_index = 1000;
	$('.col-sm-8>.upvideo').on('click','.btn-primary',function(){
		if($('.upvideo').length>=3){
			jsalert('视频最多上传六个！',2);
			return false;
		}
		var str = '<div class="upvideo">';
		str += '<input type="text" class="form-control" onclick="$(this).next().click()" readonly name="info[links][]" placeholder="点击上传视频，视频大小最大为10M"> ';
        str += '<input type="file" id="link'+vdo_index+'" name="link'+vdo_index+'" style="display:none;" onchange="upload_video(this.id)"/>';
	    str += '<span class="btn btn-danger" title="删除" > <i class="fa fa-trash-o"></i></span>';
	    str += '</div>';
		$(this).parent().parent().append(str);
        vdo_index++;
	})
	$('.col-sm-8').on('click','.upvideo>.btn-danger',function(){
		$(this).parent().remove();
	})
})
function upload_img(ele_id){
	upload(ele_id,function(data){
		if(data.status == '1'){
	 		$('#image_btn').css({'background':'url('+data.info.image_url+') no-repeat center','background-size':'cover'});
	 		$('#'+ele_id).next('input').val(data.info.image_url)
	 	}else{
	 		jsalert(data.msg,2);
	 	}
	});
}
function upload_video(ele_id){
    var layind = jsloading();
	upload_vdo(ele_id,function(data){
        //console.log(data.info)
        layer.close(layind)
		if(data.status == '1'){
	 		$('#'+ele_id).prev('input').val(data.info.video_url);
	 	}else{
	 		jsalert(data.msg,2);
	 	}
	});
}
function save(){
	$.post("{:U('Teacher/edit')}",$('#dataForm').serializeArray(),function(data){
		if(data.status == '1'){
			jsalert(data.info,1,function(){
				location.href = data.url;
			});
		}else{
			jsalert(data.info,2);
		}
	});
}
</script>
</body>
</html>